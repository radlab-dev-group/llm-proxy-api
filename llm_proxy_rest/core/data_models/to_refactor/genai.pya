from pydantic import BaseModel
from typing import List, Dict, Optional, Any

from llm_proxy_rest.base.constants import DEFAULT_EP_LANGUAGE


class _GenerativeOptions(BaseModel):
    temperature: float = 0.75
    max_new_tokens: int = 256

    top_k: int = 50
    top_p: float = 0.99
    typical_p: float = 1.0
    repetition_penalty: float = 1.2
    language: Optional[str] = DEFAULT_EP_LANGUAGE


class _GenerativeOptionsModel(_GenerativeOptions):
    model_name: str


class GenerativeConversationModel(_GenerativeOptionsModel):
    user_last_statement: str
    historical_messages: List[Dict[str, str]] = []


class ExtendedGenerativeConversationModel(GenerativeConversationModel):
    system_prompt: str


#
# LANGUAGE_PARAM = "language"
# SYSTEM_PROMPT = "system_prompt"
# MODEL_NAME_PARAM = "model_name"

GENAI_REQ_ARGS_BASE = [MODEL_NAME_PARAM]
GENAI_OPT_ARGS_BASE = [
    "max_new_tokens",
    "top_k",
    "top_p",
    "temperature",
    "typical_p",
    "repetition_penalty",
    LANGUAGE_PARAM,
]

GENAI_CONV_REQ_ARGS = GENAI_REQ_ARGS_BASE + ["user_last_statement"]
GENAI_CONV_OPT_ARGS = GENAI_OPT_ARGS_BASE + ["historical_messages"]

EXT_GENAI_CONV_REQ_ARGS = GENAI_CONV_REQ_ARGS + [SYSTEM_PROMPT]
EXT_GENAI_CONV_OPT_ARGS = GENAI_CONV_OPT_ARGS
